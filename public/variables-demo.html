<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Variable Buttons Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f6f6f7;
      color: #212b36;
      line-height: 1.5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      padding: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      min-height: 80px;
      font-family: inherit;
      resize: vertical;
    }
    .character-count {
      margin-top: 5px;
      font-size: 14px;
      color: #637381;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge.warning {
      background-color: #ffea8a;
      color: #8a6116;
    }
    .badge.critical {
      background-color: #fed3d3;
      color: #bf0711;
    }
    .badge.good {
      background-color: #bbe5b3;
      color: #108043;
    }
    
    /* Variable buttons styling */
    .variable-buttons {
      margin: 15px 0;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    .variable-buttons h3 {
      margin-top: 0;
      color: #5c6ac4;
      font-size: 16px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .variable-button {
      padding: 5px 10px;
      background-color: #5c6ac4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .variable-button:hover {
      background-color: #4959bd;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Variable Buttons Demo</h1>
    <p>This page demonstrates how the variable buttons work. Enter your text in the fields below and use the buttons to insert variables.</p>
    
    <div class="card">
      <h2>Meta Title Template</h2>
      <div class="form-group">
        <label for="metaTitle">Title Template</label>
        <textarea id="metaTitle">{{collectionTitle}} - {{season}} {{year}} Collection | {{storeName}}</textarea>
        <div class="character-count">
          <span id="metaTitleCount">0</span> characters 
          <span class="badge" id="metaTitleBadge">checking...</span>
        </div>
        
        <!-- Variable Buttons for Title -->
        <div class="variable-buttons">
          <h3>Quick Insert Variables:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{year}}')">YEAR</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{month}}')">MONTH</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{season}}')">SEASON</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{date}}')">DATE</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{productTitle}}')">PRODUCT</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{collectionTitle}}')">COLLECTION</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{storeName}}')">STORE</button>
          </div>
          
          <h3>Conditional Logic:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{if hasDiscount}}...{{endif}}')">IF DISCOUNT</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaTitle', '{{if hasDiscount}}...{{else}}...{{endif}}')">IF/ELSE</button>
          </div>
          
          <h3>Format Modifiers:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertModifier('metaTitle', ':uppercase')">UPPERCASE</button>
            <button type="button" class="variable-button" onclick="insertModifier('metaTitle', ':lowercase')">LOWERCASE</button>
          </div>
        </div>
      </div>
      
      <h2>Meta Description Template</h2>
      <div class="form-group">
        <label for="metaDescription">Description Template</label>
        <textarea id="metaDescription">Explore our {{collectionTitle}} for {{season}} {{year}}. {{if hasDiscount}}Save up to {{maxDiscountPercentage}} on selected items!{{else}}New arrivals now available.{{endif}}</textarea>
        <div class="character-count">
          <span id="metaDescriptionCount">0</span> characters 
          <span class="badge" id="metaDescriptionBadge">checking...</span>
        </div>
        
        <!-- Variable Buttons for Description -->
        <div class="variable-buttons">
          <h3>Quick Insert Variables:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{year}}')">YEAR</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{month}}')">MONTH</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{season}}')">SEASON</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{date}}')">DATE</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{productTitle}}')">PRODUCT</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{collectionTitle}}')">COLLECTION</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{storeName}}')">STORE</button>
          </div>
          
          <h3>Conditional Logic:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{if hasDiscount}}...{{endif}}')">IF DISCOUNT</button>
            <button type="button" class="variable-button" onclick="insertVariable('metaDescription', '{{if hasDiscount}}...{{else}}...{{endif}}')">IF/ELSE</button>
          </div>
          
          <h3>Format Modifiers:</h3>
          <div class="button-group">
            <button type="button" class="variable-button" onclick="insertModifier('metaDescription', ':uppercase')">UPPERCASE</button>
            <button type="button" class="variable-button" onclick="insertModifier('metaDescription', ':lowercase')">LOWERCASE</button>
          </div>
        </div>
      </div>
      
      <div style="margin-top: 20px;">
        <button id="saveBtn" style="padding: 10px 15px; background: #5c6ac4; color: white; border: none; border-radius: 4px; cursor: pointer;">Save Templates</button>
      </div>
    </div>
    
    <div class="card">
      <h2>Preview</h2>
      <div id="preview">
        <div>
          <strong>Title:</strong> <span id="titlePreview"></span>
        </div>
        <div style="margin-top: 10px;">
          <strong>Description:</strong> <span id="descriptionPreview"></span>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Function to insert variable at cursor position
    function insertVariable(textareaId, variable) {
      const textarea = document.getElementById(textareaId);
      if (!textarea) return;
      
      // Get cursor position
      const startPos = textarea.selectionStart;
      const endPos = textarea.selectionEnd;
      
      // Insert variable at cursor position
      textarea.value = textarea.value.substring(0, startPos) + 
                       variable + 
                       textarea.value.substring(endPos);
      
      // Move cursor after the inserted variable
      textarea.selectionStart = textarea.selectionEnd = startPos + variable.length;
      
      // Focus back on textarea
      textarea.focus();
      
      // Trigger input event to update character count
      const event = new Event('input', { bubbles: true });
      textarea.dispatchEvent(event);
    }
    
    // Function to insert modifier after a variable
    function insertModifier(textareaId, modifier) {
      const textarea = document.getElementById(textareaId);
      if (!textarea) return;
      
      // Get cursor position
      const startPos = textarea.selectionStart;
      const endPos = textarea.selectionEnd;
      const beforeCursor = textarea.value.substring(0, startPos);
      
      // Check if there's a variable pattern before cursor
      const variablePattern = /\{\{([^}]+)\}\}/;
      const match = beforeCursor.match(variablePattern);
      
      if (match && match.index !== -1) {
        // Find the position right after the last variable closing }}
        const variableEndPos = beforeCursor.lastIndexOf('}}');
        if (variableEndPos !== -1 && variableEndPos === startPos - 2) {
          // Insert modifier right after the variable
          textarea.value = textarea.value.substring(0, variableEndPos) + 
                           modifier +
                           textarea.value.substring(variableEndPos, textarea.value.length);
          textarea.selectionStart = textarea.selectionEnd = variableEndPos + modifier.length + 2;
        } else {
          // Just insert at cursor if we're not right after a variable
          textarea.value = beforeCursor + modifier + textarea.value.substring(endPos);
          textarea.selectionStart = textarea.selectionEnd = startPos + modifier.length;
        }
      } else {
        // Just insert at cursor if no variable pattern found
        textarea.value = beforeCursor + modifier + textarea.value.substring(endPos);
        textarea.selectionStart = textarea.selectionEnd = startPos + modifier.length;
      }
      
      // Focus back on textarea
      textarea.focus();
      
      // Trigger input event to update character count
      const event = new Event('input', { bubbles: true });
      textarea.dispatchEvent(event);
    }
    
    // Function to update character count and badge
    function updateCharCount(textareaId, countId, badgeId) {
      const textarea = document.getElementById(textareaId);
      const countElement = document.getElementById(countId);
      const badgeElement = document.getElementById(badgeId);
      
      if (!textarea || !countElement || !badgeElement) return;
      
      const length = textarea.value.length;
      countElement.textContent = length;
      
      // Update badge for title
      if (textareaId === 'metaTitle') {
        if (length > 70) {
          badgeElement.className = 'badge critical';
          badgeElement.textContent = 'Too long';
        } else if (length < 30) {
          badgeElement.className = 'badge warning';
          badgeElement.textContent = 'Too short';
        } else {
          badgeElement.className = 'badge good';
          badgeElement.textContent = 'Good length';
        }
      } 
      // Update badge for description
      else if (textareaId === 'metaDescription') {
        if (length > 160) {
          badgeElement.className = 'badge critical';
          badgeElement.textContent = 'Too long';
        } else if (length < 70) {
          badgeElement.className = 'badge warning';
          badgeElement.textContent = 'Too short';
        } else {
          badgeElement.className = 'badge good';
          badgeElement.textContent = 'Good length';
        }
      }
    }
    
    // Function to update preview
    function updatePreview() {
      const titleTemplate = document.getElementById('metaTitle').value;
      const descTemplate = document.getElementById('metaDescription').value;
      
      // Simple mock variable replacement - in a real app this would call your API
      const mockVariables = {
        year: '2025',
        month: 'May',
        season: 'Summer',
        date: 'May 6, 2025',
        productTitle: 'Sample Product',
        collectionTitle: 'Summer Collection',
        storeName: 'Your Store',
        hasDiscount: true,
        maxDiscountPercentage: '40%'
      };
      
      // Very simple parser - just for demo
      let titlePreview = titleTemplate;
      let descPreview = descTemplate;
      
      // Replace basic variables
      for (const [key, value] of Object.entries(mockVariables)) {
        if (typeof value !== 'boolean') {
          const regex = new RegExp(`\\{\\{${key}\\}\\}`, 'g');
          titlePreview = titlePreview.replace(regex, value);
          descPreview = descPreview.replace(regex, value);
        }
      }
      
      // Handle conditionals - very simplified for demo
      const ifDiscountRegex = /\{\{if hasDiscount\}\}(.*?)\{\{else\}\}(.*?)\{\{endif\}\}/g;
      const ifDiscountSimpleRegex = /\{\{if hasDiscount\}\}(.*?)\{\{endif\}\}/g;
      
      if (mockVariables.hasDiscount) {
        titlePreview = titlePreview.replace(ifDiscountRegex, '$1');
        descPreview = descPreview.replace(ifDiscountRegex, '$1');
        
        titlePreview = titlePreview.replace(ifDiscountSimpleRegex, '$1');
        descPreview = descPreview.replace(ifDiscountSimpleRegex, '$1');
      } else {
        titlePreview = titlePreview.replace(ifDiscountRegex, '$2');
        descPreview = descPreview.replace(ifDiscountRegex, '$2');
        
        titlePreview = titlePreview.replace(ifDiscountSimpleRegex, '');
        descPreview = descPreview.replace(ifDiscountSimpleRegex, '');
      }
      
      // Update preview
      document.getElementById('titlePreview').textContent = titlePreview;
      document.getElementById('descriptionPreview').textContent = descPreview;
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      const metaTitleTextarea = document.getElementById('metaTitle');
      const metaDescriptionTextarea = document.getElementById('metaDescription');
      
      // Set up event listeners for character count
      if (metaTitleTextarea) {
        metaTitleTextarea.addEventListener('input', function() {
          updateCharCount('metaTitle', 'metaTitleCount', 'metaTitleBadge');
          updatePreview();
        });
      }
      
      if (metaDescriptionTextarea) {
        metaDescriptionTextarea.addEventListener('input', function() {
          updateCharCount('metaDescription', 'metaDescriptionCount', 'metaDescriptionBadge');
          updatePreview();
        });
      }
      
      // Set up save button
      const saveBtn = document.getElementById('saveBtn');
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          alert('Templates saved! (This is just a demo)');
        });
      }
      
      // Initialize character counts and preview
      updateCharCount('metaTitle', 'metaTitleCount', 'metaTitleBadge');
      updateCharCount('metaDescription', 'metaDescriptionCount', 'metaDescriptionBadge');
      updatePreview();
    });
  </script>
</body>
</html>